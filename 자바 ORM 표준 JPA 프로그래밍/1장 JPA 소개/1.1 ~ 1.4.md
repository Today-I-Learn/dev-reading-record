# 1장 JPA 소개

## SQL 을 직접 다룰 때 발생하는 문제점

- SQL 에 의존적인 개발로 SQL 중심의 의존 관계가 생김
- 엔티티를 신뢰할 수 없음
    - DAO 를 열어서 어떤 SQL 이 실행되고 어떤 객체가 함께 조회되는지 일일이 확인해야함
- 진정한 의미의 계층 분할이 어려움
    - 논리적으로 엔티티오 아주 강한 의존관계를 가짐

## 패러다임의 불일치

### 상속

- 객체는 상속이라는 기능을 가지고 있지만 테이블은 상속이라는 기능이 없음
- JPA 는 상속과 관련된 패러다임의 불일치 문제를 개발자가 대신 해결해줌
- 개발자는 마치 자바 컬렉션에 객체를 저장하듯이 JPA 에게 객체를 저장하면 됨

### 연관관계

- 객체는 참조를 사용해서 다른 객체와 연관관계를 가지고 참조에 접근해서 연관된 객체를 조회함
- 테이블은 외래 키를 사용해서 다른 테이블과 연관관계를 가지고 조인을 사용해서 연관된 테이블을 조회함
- 객체는 참조가 있는 방향으로만 조회할 수 있는데, 테이블은 외래 키 하나로 양방향으로 모두 조회가 가능함
- JPA 는 참조를 외래키로 변환해서 적절한 SQL을 데이터베이스에 전달하고, 외래 키를 참조로 변환하는 일도  처리해줌

### 객체 그래프 탐색

SQL 을 직접 다루면 처음 실행하는 SQL 에 따라 객체 그래프를 어디까지 탐색할 수 있는지 정해진다. 이것은 객체지향 개발자에겐 너무나 큰 제약이고 SQL 에 의존적인 개발이 될 수 밖에 없다.

JPA 는 연관된 객체를 즉시 함께 조회할지 아니면 실제 사용되는 시점에 지연해서 조회할지를 간단하게 설정할 수 있고, 연관된 객체를 신뢰하고 마음껏 조회할 수 있다.

실제 객체를 사용하는 시점까지 데이터베이스 조회를 미뤘다가 조회하는것을 **지연 로딩** 이라 한다.

## JPA 란 무엇일까?

JPA(Java Persistence API)는 자바 진영의 ORM 기술 표준이다. JPA 는 애플리케이션과 JDBC 사이에서 동작한다. 여기서 ORM(Object-Relational Mapping) 이란 이름 그대로 객체와 관계형 데이터베이스를 매핑한다는 뜻이다. ORM 프레임워크는 객체와 테이블을 매핑해서 적절한 SQL도 대신 생성해주고, 패러다임의 불일치 문제를 개발자 대신 해결해준다. 덕분에 개발자는 데이터 중심인 관계형 데이터베이스를 사용해도 객체지향 애플리케이션 개발에 집중할 수 있다.

### JPA 소개

JPA 는 자바 ORM 기술에 대한 API 표준 명세다. 쉽게 이야기해서 인터페이스를 모아둔 것이다. 따라서 JPA 를 사용하려면 JPA 를 구현한 ORM 프레임워크를 선택해야 한다. JPA 를 구현한 ORM 프레임워크는 하이버네이트, EclipseLink, DataNucleus 가 있는데 이 중에 하이버네이트가 가장 대중적이다.

### 왜 JPA 를 사용해야 하는가?

- 생산성

  JPA 를 사용하면 자바 컬렉션에 객체를 저장하듯이 JPA 에게 저장 할 객체를 전달하면 된다. 따라서 지루하고 반복적인 코드와 CRUD 용 SQL 을 개발자가 직접 작성하지 않아도 된다. 이런 기능들을 사용하면 데이터베이스 설계 중심의 패러다임을 객체 설계 중심으로 역전시킬 수 있다.

- 유지보수

  필드를 추가하거나 삭제할때 개발자가 작성해야 했던 SQL 과 JDBC API 코드를 JPA 가 대신 처리해주므로 유지보수해야 하는 코드가 줄어든다. 또한, JPA 가 패러다임의 불일치 문제를 해결해주므로 객체지향 언어가 가진 장점들을 활용해서 유연하고 유지보수하기 좋은 도메인 모델을 편리하게 설계할 수 있다.

- 패러다임의 불일치 해결

  JPA 는 상속, 연관관계, 객체 그래프 탐색, 비교하기와 같은 패러다임의 불일치 문제를 해결해준다.

- 성능

  JPA 는 애플리케이션과 데이터베이스 사이에서 다양한 성능 최적화 기회를 제공한다. 애플리케이션과 데이터베이스 사이에 계층을 하나 더 두면서 최적화 관점에서 시도해볼 수 있는게 많아지게 된다.

- 데이터 접근 추상화와 벤더 독립성

  JPA 는 애플리케이션과 데이터베이스 사이에 추상화된 데이터 접근 계층을 제공해서 애플리케이션이 특정 데이터베이스 기술에 종속되지 않도록 한다. 만약 데이터베이스를 변경하면 JPA 에게 다른 데이터베이스를 사용한다고 알려주기만 하면 된다.

- 표준

  JPA 는 자바 진영의 ORM 기술 표준이다. 표준을 사용하면 다른 구현 기술로 손쉽게 변경할 수 있다.